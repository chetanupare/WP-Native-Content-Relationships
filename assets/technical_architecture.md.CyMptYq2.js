import{_ as t,c as a,o,ag as i}from"./chunks/framework.D7F4Kr4v.js";const g=JSON.parse('{"title":"Architecture","description":"","frontmatter":{"title":"Architecture"},"headers":[],"relativePath":"technical/architecture.md","filePath":"technical/architecture.md","lastUpdated":1771058478000}'),r={name:"technical/architecture.md"};function s(n,e,c,l,d,p){return o(),a("div",null,[...e[0]||(e[0]=[i('<h1 id="architecture-overview" tabindex="-1">Architecture overview <a class="header-anchor" href="#architecture-overview" aria-label="Permalink to &quot;Architecture overview&quot;">​</a></h1><p>High-level architecture of the Native Content Relationships plugin.</p><h2 id="system-components" tabindex="-1">System components <a class="header-anchor" href="#system-components" aria-label="Permalink to &quot;System components&quot;">​</a></h2><ul><li><strong>Core:</strong> Public API (<code>ncr_add_relation</code>, etc.) → Relationship Type Registry → Database (<code>wp_content_relations</code>) + Object Cache</li><li><strong>Integrity:</strong> WP-CLI / Cron → Repair logic → Schema &amp; constraint checks → reads/writes DB</li><li><strong>Interfaces:</strong> Admin Meta Box, REST API, Elementor Dynamic Tags → all use the Public API</li></ul><p><em>(A Mermaid diagram of this flow is in the repo: <code>docs/ARCHITECTURE.md</code>.)</em></p><h2 id="key-components" tabindex="-1">Key components <a class="header-anchor" href="#key-components" aria-label="Permalink to &quot;Key components&quot;">​</a></h2><h3 id="_1-registry-layer-class-relation-types-php" tabindex="-1">1. Registry layer (<code>class-relation-types.php</code>) <a class="header-anchor" href="#_1-registry-layer-class-relation-types-php" aria-label="Permalink to &quot;1. Registry layer (`class-relation-types.php`)&quot;">​</a></h3><ul><li><strong>Responsibility</strong>: Defines allowed relationship types and their constraints.</li><li><strong>Constraints</strong>: <ul><li><code>max_connections</code> (e.g. One Post to One Author)</li><li><code>direction</code> (e.g. <code>bidirectional</code>, <code>from_to</code>, <code>to_from</code>)</li><li><code>object_types</code> (e.g. <code>post</code>, <code>user</code>, <code>term</code>)</li></ul></li></ul><h3 id="_2-database-layer-class-database-php" tabindex="-1">2. Database layer (<code>class-database.php</code>) <a class="header-anchor" href="#_2-database-layer-class-database-php" aria-label="Permalink to &quot;2. Database layer (`class-database.php`)&quot;">​</a></h3><ul><li><strong>Table</strong>: <code>wp_content_relations</code></li><li><strong>Indexing</strong>: <ul><li>Composite indexes on <code>(from_id, type)</code> and <code>(to_id, type)</code>.</li><li>Covering index on <code>(type, from_id, to_id)</code>.</li></ul></li><li><strong>Schema guard</strong>: <code>NCR_SCHEMA_VERSION</code> ensures DB structure updates run only when needed.</li></ul><h3 id="_3-integrity-engine-class-integrity-php" tabindex="-1">3. Integrity engine (<code>class-integrity.php</code>) <a class="header-anchor" href="#_3-integrity-engine-class-integrity-php" aria-label="Permalink to &quot;3. Integrity engine (`class-integrity.php`)&quot;">​</a></h3><ul><li><strong>Responsibility</strong>: Detects and fixes data inconsistencies.</li><li><strong>Features</strong>: <ul><li><strong>Chunked processing</strong>: Handles large datasets (1M+ rows) in small batches.</li><li><strong>Orphan detection</strong>: Removes relationships pointing to deleted posts/users.</li><li><strong>Constraint enforcement</strong>: Checks <code>max_connections</code>.</li></ul></li></ul><h3 id="_4-public-api-class-api-php" tabindex="-1">4. Public API (<code>class-api.php</code>) <a class="header-anchor" href="#_4-public-api-class-api-php" aria-label="Permalink to &quot;4. Public API (`class-api.php`)&quot;">​</a></h3><ul><li><strong>Facade</strong>: Simple, safe interface (<code>ncr_add_relation</code>, <code>ncr_get_related</code>).</li><li><strong>Validation</strong>: Enforces registry rules before writing to DB.</li><li><strong>Caching</strong>: Object caching to minimize DB queries.</li></ul>',14)])])}const u=t(r,[["render",s]]);export{g as __pageData,u as default};
