import{_ as i,c as t,o as s,ag as a}from"./chunks/framework.D7F4Kr4v.js";const k=JSON.parse('{"title":"Capabilities & Permissions","description":"naticore_create_relation, naticore_delete_relation, map_meta_cap, and custom roles.","frontmatter":{"title":"Capabilities & Permissions","description":"naticore_create_relation, naticore_delete_relation, map_meta_cap, and custom roles."},"headers":[],"relativePath":"extending/capabilities.md","filePath":"extending/capabilities.md","lastUpdated":1771061476000}'),n={name:"extending/capabilities.md"};function o(l,e,r,p,h,d){return s(),t("div",null,[...e[0]||(e[0]=[a(`<h1 id="capabilities-permissions" tabindex="-1">Capabilities &amp; Permissions <a class="header-anchor" href="#capabilities-permissions" aria-label="Permalink to &quot;Capabilities &amp; Permissions&quot;">​</a></h1><p>NCR gates <strong>creating</strong> and <strong>deleting</strong> relationships with two meta capabilities. Who can edit the source object (post, user, or term) can manage its relationships.</p><hr><h2 id="meta-capabilities" tabindex="-1">Meta capabilities <a class="header-anchor" href="#meta-capabilities" aria-label="Permalink to &quot;Meta capabilities&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Capability</th><th>Used for</th><th>Mapped to</th></tr></thead><tbody><tr><td><code>naticore_create_relation</code></td><td>Adding a relation (from_id → to_id, type)</td><td>Edit permission on the <strong>source</strong> object</td></tr><tr><td><code>naticore_delete_relation</code></td><td>Removing a relation</td><td>Same</td></tr></tbody></table><p><strong>Mapping:</strong></p><ul><li><strong>Post</strong> as source → <code>edit_post</code> for that post (so authors can manage relations on their own posts, editors on editable posts).</li><li><strong>User</strong> as source → <code>edit_user</code> for that user (so users can manage their own profile relations if they can edit their profile).</li><li><strong>Term</strong> as source → <code>edit_term</code> for that term (so users who can edit the term can manage its relations).</li></ul><p>If the source ID is missing, the check falls back to requiring a high-level capability so the UI doesn’t leak.</p><hr><h2 id="allowing-or-blocking-specific-relations" tabindex="-1">Allowing or blocking specific relations <a class="header-anchor" href="#allowing-or-blocking-specific-relations" aria-label="Permalink to &quot;Allowing or blocking specific relations&quot;">​</a></h2><p><strong>Filter:</strong> <code>naticore_relation_is_allowed</code></p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add_filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">( </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;naticore_relation_is_allowed&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ( $allowed, $context ) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// $context: [ &#39;from_id&#39; =&gt; int, &#39;to_id&#39; =&gt; int, &#39;type&#39; =&gt; string ]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ( $context[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;type&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;favorite_posts&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> some_custom_rule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">( $context ) ) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $allowed;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> );</span></span></code></pre></div><p>Return <code>false</code> to block that relation even if the user has the capability. Use for business rules (e.g. “no relations from this post type to that one”).</p><hr><h2 id="custom-roles" tabindex="-1">Custom roles <a class="header-anchor" href="#custom-roles" aria-label="Permalink to &quot;Custom roles&quot;">​</a></h2><p>If you use custom roles:</p><ul><li><strong>Grant</strong> <code>naticore_create_relation</code> and <code>naticore_delete_relation</code> to allow relationship management without mapping to edit_post/edit_user/edit_term; or</li><li><strong>Leave unmapped:</strong> NCR will map them to the appropriate edit_* meta cap, so anyone who can edit the post/user/term can manage its relations.</li></ul><p>For a role that should only manage relationships without editing content, you’d need to add the naticore capabilities and ensure your UI checks those caps.</p><hr><h2 id="test-bypass-development" tabindex="-1">Test / bypass (development) <a class="header-anchor" href="#test-bypass-development" aria-label="Permalink to &quot;Test / bypass (development)&quot;">​</a></h2><p>When <code>NCR_TEST_MODE</code> is defined and true, capability checks are bypassed so tests can create/remove relations without setting up roles. Do not enable in production.</p><hr><h2 id="see-also" tabindex="-1">See also <a class="header-anchor" href="#see-also" aria-label="Permalink to &quot;See also&quot;">​</a></h2><ul><li><a href="/WP-Native-Content-Relationships/guide/troubleshooting.html#permission-errors-when-creating-relations">Troubleshooting</a> — Permission errors</li><li><a href="/WP-Native-Content-Relationships/api/hooks-filters.html">Hooks &amp; Filters</a> — <code>naticore_relation_is_allowed</code></li></ul>`,24)])])}const g=i(n,[["render",o]]);export{k as __pageData,g as default};
