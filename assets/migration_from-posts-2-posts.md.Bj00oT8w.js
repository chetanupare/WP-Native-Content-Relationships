import{_ as i,c as a,o as t,ag as n}from"./chunks/framework.D7F4Kr4v.js";const c=JSON.parse('{"title":"Migrating from Posts 2 Posts","description":"","frontmatter":{"title":"Migrating from Posts 2 Posts"},"headers":[],"relativePath":"migration/from-posts-2-posts.md","filePath":"migration/from-posts-2-posts.md","lastUpdated":1771061476000}'),e={name:"migration/from-posts-2-posts.md"};function p(o,s,l,h,r,k){return t(),a("div",null,[...s[0]||(s[0]=[n(`<h1 id="migrating-from-posts-2-posts" tabindex="-1">Migrating from Posts 2 Posts <a class="header-anchor" href="#migrating-from-posts-2-posts" aria-label="Permalink to &quot;Migrating from Posts 2 Posts&quot;">​</a></h1><p>If you use the <strong>Posts 2 Posts</strong> (P2P) plugin, you can migrate relationship data to Native Content Relationships.</p><h2 id="comparison" tabindex="-1">Comparison <a class="header-anchor" href="#comparison" aria-label="Permalink to &quot;Comparison&quot;">​</a></h2><ul><li><strong>P2P</strong> uses a custom table and defines “connection types” with direction and cardinality.</li><li><strong>NCR</strong> uses a single relations table and “relation types” with <code>from</code>/<code>to</code> object types and optional <code>max_connections</code>.</li></ul><h2 id="approach" tabindex="-1">Approach <a class="header-anchor" href="#approach" aria-label="Permalink to &quot;Approach&quot;">​</a></h2><ol><li><strong>Map connection types</strong> — For each P2P connection type, define an NCR relation type (same or similar name) with <a href="/WP-Native-Content-Relationships/extending/custom-types.html">ncr_register_relation_type</a>. Map P2P “from”/“to” post types to NCR <code>from</code>/<code>to</code> (use <code>post</code> for any post type unless you need user/term).</li><li><strong>Export P2P data</strong> — P2P stores rows in its table (e.g. <code>p2p_id</code>, <code>p2p_from</code>, <code>p2p_to</code>, <code>p2p_type</code>). Use a SQL export or P2P’s API to get (from_id, to_id, type).</li><li><strong>Import</strong> — For each row, call <code>ncr_add_relation( $from_id, &#39;post&#39;, $to_id, &#39;post&#39;, $mapped_type )</code>. Handle duplicate prevention if your script runs multiple times.</li><li><strong>Replace code</strong> — Replace P2P API calls with <a href="/WP-Native-Content-Relationships/api/php-api.html">ncr_get_related</a> and <a href="/WP-Native-Content-Relationships/api/wp-query.html">WP_Query</a> using <code>content_relation</code>. Update templates and any P2P-specific shortcodes or blocks to NCR equivalents.</li><li><strong>Deactivate P2P</strong> — After verification, deactivate and optionally uninstall P2P.</li></ol><h2 id="copy-paste-migration-example" tabindex="-1">Copy-paste migration example <a class="header-anchor" href="#copy-paste-migration-example" aria-label="Permalink to &quot;Copy-paste migration example&quot;">​</a></h2><p><strong>Step 1 — Export P2P data.</strong> If you have DB access, you can export (from the P2P table, e.g. <code>wp_p2p</code>) rows with <code>p2p_from</code>, <code>p2p_to</code>, <code>p2p_type</code>. Save to a CSV or PHP array.</p><p><strong>Step 2 — Map P2P type to NCR type.</strong> Register the NCR type if needed (see <a href="/WP-Native-Content-Relationships/extending/custom-types.html">Custom types</a>), e.g. map P2P <code>my_connection</code> → NCR <code>my_connection</code>.</p><p><strong>Step 3 — Import.</strong> Example: you have an array of rows <code>[ &#39;from&#39; =&gt; id, &#39;to&#39; =&gt; id, &#39;type&#39; =&gt; &#39;my_connection&#39; ]</code>.</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">php</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// migrate-p2p-to-ncr.php — run once. $p2p_rows = your exported data.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ( </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> function_exists</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">( </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ncr_add_relation&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ) ) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$p2p_rows </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* e.g. from DB or CSV: [ [&#39;from&#39;=&gt;123,&#39;to&#39;=&gt;456,&#39;type&#39;=&gt;&#39;my_connection&#39;], ... ] */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$type_map </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;my_connection&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;my_connection&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ]; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// P2P type =&gt; NCR type</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">foreach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ( $p2p_rows </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $row ) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	$ncr_type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $type_map[ $row[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;type&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] ] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $row[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;type&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	$from </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) $row[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;from&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	$to   </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) $row[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;to&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ( $from </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $to </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> get_post_status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">( $from ) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> get_post_status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">( $to ) ) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">		ncr_add_relation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">( $from, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;post&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, $to, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;post&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, $ncr_type );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>Before (P2P):</strong> <code>p2p_get_related_posts( $post_id, &#39;my_connection&#39; )</code> or similar.<br><strong>After (NCR):</strong> <code>ncr_get_related( $post_id, &#39;post&#39;, &#39;my_connection&#39; )</code> and <a href="/WP-Native-Content-Relationships/api/wp-query.html">WP_Query</a> with <code>content_relation</code>.</p><h2 id="notes" tabindex="-1">Notes <a class="header-anchor" href="#notes" aria-label="Permalink to &quot;Notes&quot;">​</a></h2><ul><li>P2P supports multiple connection types per pair; NCR supports multiple relation types. Map each P2P connection type to one NCR relation type.</li><li>Run <code>wp content-relations check</code> and spot-check front-end and admin before removing P2P.</li></ul>`,14)])])}const E=i(e,[["render",p]]);export{c as __pageData,E as default};
