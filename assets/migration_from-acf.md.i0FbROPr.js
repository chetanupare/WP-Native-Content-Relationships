import{_ as i,c as a,o as t,ag as n}from"./chunks/framework.D7F4Kr4v.js";const E=JSON.parse('{"title":"Migrating from ACF Relationship Fields","description":"","frontmatter":{"title":"Migrating from ACF Relationship Fields"},"headers":[],"relativePath":"migration/from-acf.md","filePath":"migration/from-acf.md","lastUpdated":1771059521000}'),e={name:"migration/from-acf.md"};function l(p,s,h,k,r,d){return t(),a("div",null,[...s[0]||(s[0]=[n(`<h1 id="migrating-from-acf-relationship-fields" tabindex="-1">Migrating from ACF Relationship Fields <a class="header-anchor" href="#migrating-from-acf-relationship-fields" aria-label="Permalink to &quot;Migrating from ACF Relationship Fields&quot;">​</a></h1><p>If you store relationships in <strong>Advanced Custom Fields</strong> relationship fields, you can move them into Native Content Relationships.</p><h2 id="approach" tabindex="-1">Approach <a class="header-anchor" href="#approach" aria-label="Permalink to &quot;Approach&quot;">​</a></h2><ol><li><strong>Export ACF data</strong> — ACF stores relationship post IDs in post meta (e.g. <code>my_relation</code> as a serialized array or multiple <code>my_relation_0</code>, <code>my_relation_1</code> keys). Use WP-CLI, a custom script, or ACF’s export to get post ID → related post IDs.</li><li><strong>Choose a relation type</strong> — Register or use an existing type (e.g. <code>related_to</code>) in NCR. See <a href="/WP-Native-Content-Relationships/extending/custom-types.html">Custom types</a>.</li><li><strong>Import</strong> — For each post with ACF relations, call <code>ncr_add_relation( $post_id, &#39;post&#39;, $related_id, &#39;post&#39;, &#39;related_to&#39; )</code> for each related post.</li><li><strong>Switch code</strong> — Replace ACF <code>get_field( &#39;my_relation&#39;, $post_id )</code> with <code>ncr_get_related( $post_id, &#39;post&#39;, &#39;related_to&#39; )</code> and <a href="/WP-Native-Content-Relationships/api/wp-query.html">WP_Query</a> where needed.</li><li><strong>Optional</strong> — Remove or repurpose the ACF field after verification.</li></ol><h2 id="copy-paste-migration-script" tabindex="-1">Copy-paste migration script <a class="header-anchor" href="#copy-paste-migration-script" aria-label="Permalink to &quot;Copy-paste migration script&quot;">​</a></h2><p>Assume ACF stores related post IDs in meta key <code>my_relation</code> (array of IDs, or ACF’s serialized format). Run once (e.g. via WP-CLI: <code>wp eval-file migrate-acf-to-ncr.php</code> or from a one-off admin page).</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">php</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// migrate-acf-to-ncr.php — run once. Replace meta key and type as needed.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ( </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> function_exists</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">( </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ncr_add_relation&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ) ) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$acf_meta_key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;my_relation&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Your ACF relationship field name</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$ncr_type     </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;related_to&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// NCR relation type</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$posts </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> get_posts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">( [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	&#39;post_type&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;post&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	&#39;post_status&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;any&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	&#39;posts_per_page&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	&#39;fields&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">         =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;ids&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	&#39;meta_query&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">     =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ [ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;key&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $acf_meta_key, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;compare&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;EXISTS&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ] ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">foreach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ( $posts </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $post_id ) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	$related </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> get_post_meta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">( $post_id, $acf_meta_key, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> );</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ( </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> is_array</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">( $related ) ) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		$related </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> array_filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">( (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">array</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) $related );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	foreach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ( $related </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $related_id ) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		$related_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) $related_id;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ( $related_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> get_post_status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">( $related_id ) ) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">			ncr_add_relation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">( $post_id, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;post&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, $related_id, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;post&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, $ncr_type );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>Before (ACF):</strong> <code>$related = get_field( &#39;my_relation&#39;, $post_id );</code><br><strong>After (NCR):</strong> <code>$related = ncr_get_related( $post_id, &#39;post&#39;, &#39;related_to&#39; );</code></p><h2 id="notes" tabindex="-1">Notes <a class="header-anchor" href="#notes" aria-label="Permalink to &quot;Notes&quot;">​</a></h2><ul><li>ACF relationship fields are one-way (post → posts). NCR supports direction; use <code>direction =&gt; &#39;outgoing&#39;</code> when querying.</li><li>Run a small batch first and compare counts; then run full migration and <code>wp content-relations check</code> to validate.</li></ul>`,10)])])}const g=i(e,[["render",l]]);export{E as __pageData,g as default};
