import{_ as a,c as e,o as i,ag as n}from"./chunks/framework.D7F4Kr4v.js";const E=JSON.parse('{"title":"Architecture Overview","description":"","frontmatter":{},"headers":[],"relativePath":"ARCHITECTURE.md","filePath":"ARCHITECTURE.md","lastUpdated":1770804519000}'),t={name:"ARCHITECTURE.md"};function l(p,s,r,o,c,h){return i(),e("div",null,[...s[0]||(s[0]=[n(`<h1 id="architecture-overview" tabindex="-1">Architecture Overview <a class="header-anchor" href="#architecture-overview" aria-label="Permalink to &quot;Architecture Overview&quot;">​</a></h1><p>This document outlines the high-level architecture of the Native Content Relationships plugin.</p><h2 id="system-components" tabindex="-1">System Components <a class="header-anchor" href="#system-components" aria-label="Permalink to &quot;System Components&quot;">​</a></h2><div class="language-mermaid vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph TD</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subgraph Core [&quot;Core System&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        API[Public API&lt;br/&gt;(ncr_add_relation)]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Registry[Relationship Type Registry]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        DB[(Database Table&lt;br/&gt;wp_content_relations)]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Cache[Object Cache]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subgraph Integrity [&quot;Integrity Engine&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        CLI[WP-CLI Commands]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Cron[Scheduled Tasks]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Repair[Repair Logic]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Validation[Schema &amp; Constraint Checks]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subgraph Interfaces [&quot;Interfaces&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        MetaBox[Admin Meta Box]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        REST[REST API]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Elementor[Elementor Dynamic Tags]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    %% Connections</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    API --&gt; Registry : Validates Type</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    API --&gt; DB : Writes Data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    API --&gt; Cache : Invalidate/Read</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Registry --&gt; Validation : Defines Constraints</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    CLI --&gt; Repair : Triggers</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Cron --&gt; Repair : Triggers</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Repair --&gt; DB : Reads/Fixes</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    MetaBox --&gt; API : Uses</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    REST --&gt; API : Uses</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Elementor --&gt; API : Reads</span></span></code></pre></div><h2 id="key-components" tabindex="-1">Key Components <a class="header-anchor" href="#key-components" aria-label="Permalink to &quot;Key Components&quot;">​</a></h2><h3 id="_1-registry-layer-class-relation-types-php" tabindex="-1">1. Registry Layer (<code>class-relation-types.php</code>) <a class="header-anchor" href="#_1-registry-layer-class-relation-types-php" aria-label="Permalink to &quot;1. Registry Layer (\`class-relation-types.php\`)&quot;">​</a></h3><ul><li><strong>Responsibility</strong>: Defines allowed relationship types and their constraints.</li><li><strong>Constraints</strong>: <ul><li><code>max_connections</code> (e.g., One Post to One Author)</li><li><code>direction</code> (e.g., <code>bidirectional</code>, <code>from_to</code>, <code>to_from</code>)</li><li><code>object_types</code> (e.g., <code>post</code>, <code>user</code>, <code>term</code>)</li></ul></li></ul><h3 id="_2-database-layer-class-database-php" tabindex="-1">2. Database Layer (<code>class-database.php</code>) <a class="header-anchor" href="#_2-database-layer-class-database-php" aria-label="Permalink to &quot;2. Database Layer (\`class-database.php\`)&quot;">​</a></h3><ul><li><strong>Table</strong>: <code>wp_content_relations</code></li><li><strong>Indexing</strong>: <ul><li>Composite indexes on <code>(from_id, type)</code> and <code>(to_id, type)</code>.</li><li>Covering index on <code>(type, from_id, to_id)</code>.</li></ul></li><li><strong>Schema Guard</strong>: <code>NATICORE_SCHEMA_VERSION</code> ensures DB structure updates run only when needed.</li></ul><h3 id="_3-integrity-engine-class-integrity-php" tabindex="-1">3. Integrity Engine (<code>class-integrity.php</code>) <a class="header-anchor" href="#_3-integrity-engine-class-integrity-php" aria-label="Permalink to &quot;3. Integrity Engine (\`class-integrity.php\`)&quot;">​</a></h3><ul><li><strong>Responsibility</strong>: Detects and fixes data inconsistencies.</li><li><strong>Features</strong>: <ul><li><strong>Chunked Processing</strong>: Handles large datasets (1M+ rows) in small batches to manage memory.</li><li><strong>orphan detection</strong>: Removes relationships pointing to deleted posts/users.</li><li><strong>Constraint Enforcement</strong>: checks <code>max_connections</code>.</li></ul></li></ul><h3 id="_4-public-api-class-api-php" tabindex="-1">4. Public API (<code>class-api.php</code>) <a class="header-anchor" href="#_4-public-api-class-api-php" aria-label="Permalink to &quot;4. Public API (\`class-api.php\`)&quot;">​</a></h3><ul><li><strong>Facade</strong>: Provides a simple, safe interface for developers (<code>ncr_add_relation</code>, <code>ncr_get_related</code>).</li><li><strong>Validation</strong>: Enforces registry rules before writing to DB.</li><li><strong>Caching</strong>: Implements intelligent object caching to minimize DB queries.</li></ul>`,13)])])}const g=a(t,[["render",l]]);export{E as __pageData,g as default};
